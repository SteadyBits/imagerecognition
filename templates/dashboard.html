{% extends templat %}
{% load i18n %}

{#{% load css_filter %}#}
{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Right side column. Contains the navbar and content of the page -->
            <aside class="right-side">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        Dashboard
                        <small>Control panel</small>
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li class="active">Dashboard</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">

                    <!-- Small boxes (Stat box) -->
                    <div class="row">
                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-yellow">
                                <div class="inner">
                                    <h3>
                                        {{ successful }}
                                    </h3>
                                    <p>
                                        Successful Transactions
                                    </p>
                                </div>
                                <div class="icon">
                                    <i class="ion ion-stats-bars"></i>
                                </div>
                                <a href="/list_transaction/success" class="small-box-footer">
                                    More info <i class="fa fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div><!-- ./col -->

                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-green">
                                <div class="inner">
                                    <h3>
                                        {{ approved }}
                                    </h3>
                                    <p>
                                        Approved Payments
                                    </p>
                                </div>
                                <div class="icon">
                                    <i class="ion ion-pie-graph"></i>
                                </div>
                                <a href="/list_transaction/approved" class="small-box-footer">
                                    More info <i class="fa fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div><!-- ./col -->

                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-aqua">
                                <div class="inner">
                                    <h3>
                                        {{ count }}
                                    </h3>
                                    <p>
                                        Awaiting Approval
                                    </p>
                                </div>
                                <div class="icon">
                                    <i class="ion ion-stats-bars"></i>
                                </div>
                                <a href="/list_transaction/unapproved" class="small-box-footer">
                                    More info <i class="fa fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div><!-- ./col -->

                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-red">
                                <div class="inner">
                                    <h3>
                                        {{failed}}
                                    </h3>
                                    <p>
                                        Failed Transactions
                                    </p>
                                </div>
                                <div class="icon">
                                    <i class="ion ion-pie-graph"></i>
                                </div>
                                <a href="/list_transaction/failure" class="small-box-footer">
                                    More info <i class="fa fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div><!-- ./col -->
                    </div><!-- /.row -->

                    <!-- top row -->
                    <div class="row">
                        <div class="col-xs-12 connectedSortable">
                            <video id="video" width="240" height="180" autoplay></video>
                            <canvas id="canvas" width="240" height="180"></canvas>
                            <div>
                              <input onclick="takePhoto()" id="take" type="button" value="Add Photo" />
                              <input id="snap" type="button" value="Take photo" />
                                <input id="upload" onclick="upload()" type="button" value="Upload Photo" />
                            </div>
                        </div>

                    </div>
                    {%csrf_token%}
                    <script>
                      $("#video").hide();
                      $("#canvas").hide();
                      var localstream;
                      var canvas;
                      function takePhoto(){
                        $("#video").show();
                        var video = document.getElementById("video");
                        if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia){
                          navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(function(stream){
                            video.src = window.URL.createObjectURL(stream);
                            localstream = stream;
                          })
                        }
                        canvas = document.getElementById("canvas");
                        var context = canvas.getContext('2d');
                        document.getElementById("snap").addEventListener('click', function(){
                          $("#canvas").show();
                          context.drawImage(video,0,0,240,180);
                          video.pause()
                          video.src = "";
                          localstream.getVideoTracks()[0].stop();
                        });
                      }

                      function upload() {

                          formdata = new FormData();

                              var file = canvas.toDataURL();
                              if (formdata) {
                                  alert("hey");
                                  formdata.append("image", file);
                                  jQuery.ajax({
                                      url: "/image/class/",
                                      type: "POST",
                                      data: formdata,
                                      processData: false,
                                      contentType: false,
                                      success:function(){}
                                  });
                              }
                      }
                    </script>
                </section>


            </aside><!-- /.right-side -->
{% endblock %}

